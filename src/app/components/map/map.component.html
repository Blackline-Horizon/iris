<!-- Map Main Container (adjusted to stay right of sidebar) -->
<div class="analytics-map">
  <!-- Main Content -->
  <main class="map-content">
    <!-- Map Header with Title -->
    <div class="map-header">
      <h1 class="map-title">Alert Location Map</h1>
      <div class="filter-summary" *ngIf="hasActiveFilters()">
        <span class="filter-badge">{{ getActiveFiltersCount() }} active filters</span>
      </div>
    </div>

    <!-- Map Main Area -->
    <div class="map-main">
      <!-- Loading State -->
      <div class="loading-overlay" *ngIf="isLoading">
        <div class="spinner"></div>
        <p>Loading data...</p>
      </div>
      
      <!-- Error State -->
      <div class="error-container" *ngIf="error">
        <div class="error-icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <p class="error-message">{{ error }}</p>
        <button class="retry-btn" (click)="loadData()">Retry</button>
      </div>
      
      <!-- Map Content -->
      <div class="map-view" *ngIf="!isLoading && !error">
        <!-- Metrics Row with Filter -->
        <div class="metrics-filter-row">
          <div class="metrics-container">
            <app-metric-card
              icon="fa-map-marker-alt"
              [value]="totalAlerts"
              label="Total Alerts"
              class="animate-in"
            ></app-metric-card>
            
            <app-metric-card
              icon="fa-globe-americas"
              [value]="uniqueLocations"
              label="Unique Locations"
              class="animate-in"
            ></app-metric-card>
          </div>
          
          <!-- Floating Filter Panel -->
          <div class="floating-filter-panel" [ngClass]="{'open': isFilterPanelOpen}">
            <div class="filter-buttons">
              <button class="filter-toggle-button" (click)="toggleFilterPanel()">
                <i class="fas" [ngClass]="isFilterPanelOpen ? 'fa-times' : 'fa-filter'"></i>
                <span>{{ isFilterPanelOpen ? 'Close' : 'Filters' }}</span>
              </button>
              
              <button class="reset-all-button" (click)="resetFilters()">
                <i class="fas fa-undo-alt"></i>
                <span>Reset All</span>
              </button>
            </div>
            
            <div class="compact-filter-content" *ngIf="isFilterPanelOpen">
              <app-dashboard-filters
                [filterOptions]="filterOptions"
                [appliedFilters]="appliedFilters"
                [dashboardType]="'map'"
                [compact]="true"
                [hideResetButton]="true"
                (filtersChanged)="updateFilters($event)"
                (applyFilterClicked)="applyFilters($event)"
              ></app-dashboard-filters>
            </div>
          </div>
        </div>
        
        <!-- Map Card -->
        <div class="map-card">
          <div class="map-header-card">
            <h3 class="card-title">
              <i class="fas fa-map"></i>
              Alert Locations
            </h3>
          </div>
          
          <div class="map-container" #mapContainer>
            <!-- Map will be rendered here -->
            <div id="map" style="height: 100%; width: 100%;"></div>
            
            <!-- Map Legend -->
            <div class="map-legend" *ngIf="displayedSensorTypes.length > 0">
              <div class="legend-title">Sensor Types</div>
              <div class="legend-item" *ngFor="let sensorType of displayedSensorTypes; let i = index">
                <span 
                  class="legend-color" 
                  [style.background-color]="getMarkerColor(sensorType)"
                ></span>
                <span>{{ formatSensorType(sensorType) }}</span>
              </div>
            </div>
          </div>
          
          <div class="map-footer">
            <span class="data-point">Displayed Alerts: {{ totalAlertsWithLocation }}</span>
            <span class="data-point">Countries: {{ uniqueCountries }}</span>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>